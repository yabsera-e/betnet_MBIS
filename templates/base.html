{% load static tailwind_tags %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <link href="{% static 'fontawesomefree/css/fontawesome.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'fontawesomefree/css/brands.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'fontawesomefree/css/solid.css' %}" rel="stylesheet" type="text/css">
    {% tailwind_css %}
    <title>የሚከራይ ቤት አለ {%block pagetitle %} {% endblock pagetitle %}</title>
</head>
<body class=" bg-white lg:px-28 px-2  min-h-[100rem] flex flex-col justify-between">
    {% comment %} {% if messages %}
        <div class=" absolute top-5 right-2 bg-white rounded-lg p-4 max-w-[12rem]">
        {% for message in messages %}
        <span class=" text-gray-700 font-weight-bolder" >{{ message.content }}</span>
        {% endfor %}
        </div>
    {%endif%} {% endcomment %}
    <div>
        <!-- mobile -->
        <div class="  sm:hidden py-2  text-2xl text-center w-full flex items-center justify-between ">
            <a href="{% url 'listings' %}" class="flex items-center gap-1 text-3xl">
                <div class=" flex items-end gap-2 font-serif">
                    <img class="w-10 object-cover flex-none" src="{% static 'logo.png' %}" alt="Listing Media">
                </div>
            </a>
            <div class="flex items-center gap-4">
                {%if user.is_authenticated%}
                    <div class=" ">
                        <div class="relative inline-block text-left">
                            <div>
                              <button id="menu-button-mob" type="button" class="inline-flex justify-center w-full rounded-md px-4 py-2 text-sm font-medium text-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-lime-500"  aria-expanded="false" aria-haspopup="true">
                                <i class="fas fa-bars text-lg"></i>
                              </button>
                            </div>
                            <div class="origin-top-right-mob z-60 absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1" style="display: none;">
                              <div class="py-1" role="none">
                                <a href=" {% url 'my_listings' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem" tabindex="-1" id="menu-item-0">My Listings</a>
                                <a  href="{% url 'listing_create' %}" class=" block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900">
                                    Post
                                </a>
                                <a href="{% url 'conversation_list' %}" class=" block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900">
                                    <i class="fa fa-envelope" aria-hidden="true"></i> Messages
                                </a>
                                <a href="{%url 'logout' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem" tabindex="-1" id="menu-item-2">Sign Out</a>
                              </div>
                            </div>
                        </div>
                    </div>
                {%else%}
                    <a href="{%url 'login' %}"  class="border bg-lime-600 hover:bg-lime-600 text-white font-medium py-2 px-4 rounded-md">
                        Login
                    </a>
                {%endif%}
            </div>
        </div>

        <!-- desktop -->
        <nav class="bg-white py-1 w-full  flex sm:flex-row flex-col items-center justify-between sticky top-0 z-50">
            <div class=" hidden sm:flex items-center gap-1 text-3xl">
              <a href="{% url 'listings' %}" class="flex items-center gap-1 text-3xl">
                <div class=" flex flex-col gap-0 font-serif">
                    <img class="w-[4rem] object-cover flex-none" src="{% static 'logo.png' %}" alt="Listing Media">
                </div>
              </a>
            </div>
            {% if request.path == '/listings/' %}
            <div class=" sticky w-full sm:w-[35rem] lg:w-[50rem]  top-0 sm:relative sm:top-0 mx-auto bg-white rounded-lg">
                <form class="gap-2 flex">
                    <div class="w-full">
                        <select id="city" name="city" class="w-full cursor-pointer border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500 bg-white text-gray-700 py-2 px-3 leading-tight focus:outline-none focus:shadow-outline">
                            <option value="" class="bg-white py-2 text-gray-400 ">City</option>
                            {% for city in cities %}
                            <option value="{{ city }}"
                             {% if request.GET.city == city|stringformat:"s" %}selected{% endif %}
                             class="bg-white text-gray-700 hover:bg-gray-200">{{ city }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="w-full">
                        <select id="subcity" name="subcity" class="w-full cursor-pointer border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500 bg-white text-gray-700 py-2 px-3 leading-tight focus:outline-none focus:shadow-outline">
                            <option value="" class="bg-white py-2 text-gray-400 ">Subcity</option>
                            {% for subcity in subcities %}
                            <option value="{{ subcity }}" 
                             {% if request.GET.subcity == subcity|stringformat:"s" %}selected{% endif %}
                             class="bg-white hover:bg-gray-200 {% if request.GET.subcity == subcity|stringformat:"s" %}text-black {% else %} text-gray-700 {% endif %}er:bg-gray-200 ">{{ subcity }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="w-full">
                        <select id="price" name="price" class="w-full cursor-pointer border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500 bg-white text-gray-700 py-2 px-3 leading-tight focus:outline-none focus:shadow-outline">
                            <option value="" class="bg-white text-gray-400 hover:bg-gray-200">Price range</option>
                            {% for key, value in price_ranges.items %}
                            <option value="{{ key }}"
                             {% if request.GET.price == key|stringformat:"s" %}selected{% endif %} 
                             class="bg-white text-gray-700 hover:bg-gray-200">{{ value }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="w-full">
                        <select id="price" name="bedrooms" class="w-full cursor-pointer border-gray-300 rounded-md shadow-sm focus:border-lime-500 focus:ring-lime-500 bg-white text-gray-700 py-2 px-3 leading-tight focus:outline-none focus:shadow-outline">
                            <option value="" class="bg-white text-gray-400 hover:bg-gray-200">Bedrooms</option>
                            {% for key, value in bedrooms.items %}
                            <option value="{{ key }}" 
                                {% if request.GET.bedrooms == key|stringformat:"s" %}selected{% endif %}
                                class="bg-white text-gray-700 hover:bg-gray-200">
                                {{ value }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <button id="filterButton" type="submit" class="border bg-lime-500 hover:bg-lime-700 text-white font-medium py-2 px-4 rounded-md transition-colors duration-300 ease-in-out flex items-center gap-2">
                        <i class="fas fa-search  "></i>
                        <span class=" hidden sm:block">Search</span>
                    </button>
                </form>
            </div>
            {% endif %}
            <div class=" flex  items-center gap-3">
                {%if user.is_authenticated%}
                <a href="{% url 'conversation_list' %}" class=" hidden sm:block">
                    <i  class="fa fa-envelope text-xl text-lime-500" ></i> 
                </a>
                 {%endif%}
                <a  href="{% url 'listing_create' %}" class=" hidden sm:block  border bg-lime-500 hover:bg-lime-700 text-white font-medium py-2 px-4 rounded-md">
                    Post
                </a>
                {%if user.is_authenticated%}
                <div class=" hidden sm:block">
                    <div class="relative inline-block text-left">
                        <div>
                          <button type="button" class="inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-lime-500" id="menu-button" aria-expanded="false" aria-haspopup="true">
                            {{user.first_name}}
                            <svg class="-mr-1 ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                          </button>
                        </div>
                      
                        <div class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1" style="display: none;">
                          <div class="py-1" role="none">
                            <a href=" {% url 'my_listings' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem" tabindex="-1" id="menu-item-0">My Listings</a>
                            {% comment %} <a href="{% url 'profile_update_view' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem" tabindex="-1" id="menu-item-1">Update Profile</a> {% endcomment %}
                            <a href="{%url 'logout' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900" role="menuitem" tabindex="-1" id="menu-item-2">Sign Out</a>
                          </div>
                        </div>
                    </div>
                </div>
                {%else%}
                <a href="{%url 'login' %}"  class=" hidden sm:block border bg-lime-500 hover:bg-lime-700 text-white font-medium py-2 px-4 rounded-md">
                    Login
                </a>
                {%endif%}
            </div>
            
        </nav>
        <div class=" mx-auto">
            {%block content%}
            {%endblock content%}
        </div>
    </div>

    <footer class="bg-white mt-20 ">
        <div class="mx-auto w-full max-w-screen-xl py-6 lg:py-8">
            <div class="md:flex md:justify-between">
              <div class="mb-6 md:mb-0">
                  <a href="#" class="flex items-center">
                    <img class="w-[4rem] md:w-[7rem] object-cover flex-none grayscale hover:grayscale-0 transition" src="{% static 'logo.png' %}" alt="logo">
                  </a>
              </div>
              <div>
                <form action="{% url 'comment-create' %}" method="POST" class=" flex flex-col gap-2 lg:w-[20rem]">
                    {% csrf_token %}
                    <textarea class=" rounded outline-none focus:ring-2 focus:ring-lime-500 border focus:border-lime-500 " maxlength="500" rows="3" cols="40" name="content" id="comment" placeholder="Please take a moment to share your thoughts on this website"></textarea>
                    <button type="submit" class=" bg-lime-500 text-white hover:bg-lime-700 duration-300 focus:ring-2 focus:ring-lime-300 p-2 rounded">
                        <i class="fa fa-comment" aria-hidden="true"></i>
                        submit
                    </button>
                </form>
              </div>
              <div class="grid grid-cols-2 gap-8 sm:gap-6 sm:grid-cols-3">
                  {% comment %} <div>
                      <h2 class="mb-6 text-sm font-semibold text-gray-900 uppercase ">Resources</h2>
                      <ul class="text-gray-500 dark:text-gray-400 font-medium">
                          <li class="mb-4">
                              <a href="#" class="hover:underline">Flowbite</a>
                          </li>
                          <li>
                              <a href="#" class="hover:underline">Tailwind CSS</a>
                          </li> 
                      </ul>
                  </div> {% endcomment %}
                  {% comment %} <div>
                      <h2 class="mb-6 text-sm font-semibold text-gray-900 uppercase ">Follow us</h2>
                      <ul class="text-gray-500 dark:text-gray-400 font-medium">
                           <li class="mb-4">
                              <a href="#" class="hover:underline ">Github</a>
                          </li> 
                           <li>
                              <a href="#" class="hover:underline">Discord</a>
                          </li> 
                      </ul>
                  </div> {% endcomment %}
                  <div>
                      <h2 class="mb-6 text-sm font-semibold text-gray-900 uppercase ">Legal</h2>
                      <ul class="text-gray-500 dark:text-gray-400 font-medium">
                          {% comment %} <li class="mb-4">
                              <a href="#" class="hover:underline">Privacy Policy</a>
                          </li> {% endcomment %}
                          <li>
                              <a href="{%url 'terms' %}" class="hover:underline">Terms &amp; Conditions</a>
                          </li>
                      </ul>
                  </div>
              </div>
          </div>
          <hr class="my-6 border-gray-200 sm:mx-auto dark:border-gray-700 lg:my-8">
          <div class="sm:flex sm:items-center sm:justify-between">
              <span class="text-sm text-gray-500 sm:text-center dark:text-gray-400">Made in Ethiopia ©2025 <a target="_blank" href="https://natnaellegesse.vercel.app" class="hover:underline">Natnael Legesse™</a>. All Rights Reserved.
              </span>
              <div class="flex mt-4 sm:justify-center sm:mt-0">
                  <a href="https://www.linkedin.com/in/nathnael-legesse-6239591a2/" target="_blank" class="text-gray-500 hover:text-gray-900 ">
                    <svg class="w-4 h-4" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
                        viewBox="0 0 382 382" xml:space="preserve" fill="currentColor">
                    <path fill-rule="evenodd" d="M347.445,0H34.555C15.471,0,0,15.471,0,34.555v312.889C0,366.529,15.471,382,34.555,382h312.889
                        C366.529,382,382,366.529,382,347.444V34.555C382,15.471,366.529,0,347.445,0z M118.207,329.844c0,5.554-4.502,10.056-10.056,10.056
                        H65.345c-5.554,0-10.056-4.502-10.056-10.056V150.403c0-5.554,4.502-10.056,10.056-10.056h42.806
                        c5.554,0,10.056,4.502,10.056,10.056V329.844z M86.748,123.432c-22.459,0-40.666-18.207-40.666-40.666S64.289,42.1,86.748,42.1
                        s40.666,18.207,40.666,40.666S109.208,123.432,86.748,123.432z M341.91,330.654c0,5.106-4.14,9.246-9.246,9.246H286.73
                        c-5.106,0-9.246-4.14-9.246-9.246v-84.168c0-12.556,3.683-55.021-32.813-55.021c-28.309,0-34.051,29.066-35.204,42.11v97.079
                        c0,5.106-4.139,9.246-9.246,9.246h-44.426c-5.106,0-9.246-4.14-9.246-9.246V149.593c0-5.106,4.14-9.246,9.246-9.246h44.426
                        c5.106,0,9.246,4.14,9.246,9.246v15.655c10.497-15.753,26.097-27.912,59.312-27.912c73.552,0,73.131,68.716,73.131,106.472
                        L341.91,330.654L341.91,330.654z"/>
                    </svg>
                      <span class="sr-only">Linked.in</span>
                  </a>
                  <a href="#" class="text-gray-500 hover:text-gray-900  ms-5">
                      <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 21 16">
                            <path d="M16.942 1.556a16.3 16.3 0 0 0-4.126-1.3 12.04 12.04 0 0 0-.529 1.1 15.175 15.175 0 0 0-4.573 0 11.585 11.585 0 0 0-.535-1.1 16.274 16.274 0 0 0-4.129 1.3A17.392 17.392 0 0 0 .182 13.218a15.785 15.785 0 0 0 4.963 2.521c.41-.564.773-1.16 1.084-1.785a10.63 10.63 0 0 1-1.706-.83c.143-.106.283-.217.418-.33a11.664 11.664 0 0 0 10.118 0c.137.113.277.224.418.33-.544.328-1.116.606-1.71.832a12.52 12.52 0 0 0 1.084 1.785 16.46 16.46 0 0 0 5.064-2.595 17.286 17.286 0 0 0-2.973-11.59ZM6.678 10.813a1.941 1.941 0 0 1-1.8-2.045 1.93 1.93 0 0 1 1.8-2.047 1.919 1.919 0 0 1 1.8 2.047 1.93 1.93 0 0 1-1.8 2.045Zm6.644 0a1.94 1.94 0 0 1-1.8-2.045 1.93 1.93 0 0 1 1.8-2.047 1.918 1.918 0 0 1 1.8 2.047 1.93 1.93 0 0 1-1.8 2.045Z"/>
                        </svg>
                      <span class="sr-only">Discord community</span>
                  </a>
                  <a href="#" class="text-gray-500 hover:text-gray-900  ms-5">
                      <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 17">
                        <path fill-rule="evenodd" d="M20 1.892a8.178 8.178 0 0 1-2.355.635 4.074 4.074 0 0 0 1.8-2.235 8.344 8.344 0 0 1-2.605.98A4.13 4.13 0 0 0 13.85 0a4.068 4.068 0 0 0-4.1 4.038 4 4 0 0 0 .105.919A11.705 11.705 0 0 1 1.4.734a4.006 4.006 0 0 0 1.268 5.392 4.165 4.165 0 0 1-1.859-.5v.05A4.057 4.057 0 0 0 4.1 9.635a4.19 4.19 0 0 1-1.856.07 4.108 4.108 0 0 0 3.831 2.807A8.36 8.36 0 0 1 0 14.184 11.732 11.732 0 0 0 6.291 16 11.502 11.502 0 0 0 17.964 4.5c0-.177 0-.35-.012-.523A8.143 8.143 0 0 0 20 1.892Z" clip-rule="evenodd"/>
                    </svg>
                      <span class="sr-only">Twitter page</span>
                  </a>
                  <a href="#" class="text-gray-500 hover:text-gray-900  ms-5">
                      <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 .333A9.911 9.911 0 0 0 6.866 19.65c.5.092.678-.215.678-.477 0-.237-.01-1.017-.014-1.845-2.757.6-3.338-1.169-3.338-1.169a2.627 2.627 0 0 0-1.1-1.451c-.9-.615.07-.6.07-.6a2.084 2.084 0 0 1 1.518 1.021 2.11 2.11 0 0 0 2.884.823c.044-.503.268-.973.63-1.325-2.2-.25-4.516-1.1-4.516-4.9A3.832 3.832 0 0 1 4.7 7.068a3.56 3.56 0 0 1 .095-2.623s.832-.266 2.726 1.016a9.409 9.409 0 0 1 4.962 0c1.89-1.282 2.717-1.016 2.717-1.016.366.83.402 1.768.1 2.623a3.827 3.827 0 0 1 1.02 2.659c0 3.807-2.319 4.644-4.525 4.889a2.366 2.366 0 0 1 .673 1.834c0 1.326-.012 2.394-.012 2.72 0 .263.18.572.681.475A9.911 9.911 0 0 0 10 .333Z" clip-rule="evenodd"/>
                      </svg>
                      <span class="sr-only">GitHub account</span>
                  </a>
                  <a href="#" class="text-gray-500 hover:text-gray-900  ms-5">
                      <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 0a10 10 0 1 0 10 10A10.009 10.009 0 0 0 10 0Zm6.613 4.614a8.523 8.523 0 0 1 1.93 5.32 20.094 20.094 0 0 0-5.949-.274c-.059-.149-.122-.292-.184-.441a23.879 23.879 0 0 0-.566-1.239 11.41 11.41 0 0 0 4.769-3.366ZM8 1.707a8.821 8.821 0 0 1 2-.238 8.5 8.5 0 0 1 5.664 2.152 9.608 9.608 0 0 1-4.476 3.087A45.758 45.758 0 0 0 8 1.707ZM1.642 8.262a8.57 8.57 0 0 1 4.73-5.981A53.998 53.998 0 0 1 9.54 7.222a32.078 32.078 0 0 1-7.9 1.04h.002Zm2.01 7.46a8.51 8.51 0 0 1-2.2-5.707v-.262a31.64 31.64 0 0 0 8.777-1.219c.243.477.477.964.692 1.449-.114.032-.227.067-.336.1a13.569 13.569 0 0 0-6.942 5.636l.009.003ZM10 18.556a8.508 8.508 0 0 1-5.243-1.8 11.717 11.717 0 0 1 6.7-5.332.509.509 0 0 1 .055-.02 35.65 35.65 0 0 1 1.819 6.476 8.476 8.476 0 0 1-3.331.676Zm4.772-1.462A37.232 37.232 0 0 0 13.113 11a12.513 12.513 0 0 1 5.321.364 8.56 8.56 0 0 1-3.66 5.73h-.002Z" clip-rule="evenodd"/>
                    </svg>
                      <span class="sr-only">Dribbble account</span>
                  </a>
              </div>
          </div>
        </div>
    </footer>
    </html>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script>
        $('#filterButton').click(function() {
            var city = $('#city').val();
            var subcity = $('#subcity').val();
            var price = $('#price').val();

            console.log(city)
            
            var url = '{% url "listings" %}?city=' + city + '&subcity=' + subcity + '&price=' + price;
            window.location.href = url;
        }); 

        const menuButton = document.getElementById('menu-button');
        const menuButtonmob = document.getElementById('menu-button-mob');
        const menuOptions = document.querySelector('.origin-top-right');
        const menuOptionsmob = document.querySelector('.origin-top-right-mob');


        menuButton.addEventListener('click', () => {
          menuOptions.style.display = menuOptions.style.display === 'none' ? 'block' : 'none';
          menuButton.setAttribute('aria-expanded', menuOptions.style.display === 'none' ? 'false' : 'true');
        });

        menuButtonmob.addEventListener('click', () => {
            menuOptionsmob.style.display = menuOptionsmob.style.display === 'none' ? 'block' : 'none';
            menuButtonmob.setAttribute('aria-expanded', menuOptionsmob.style.display === 'none' ? 'false' : 'true');
          });

        document.addEventListener('click', (event) => {
          if (!menuButton.contains(event.target) && !menuOptions.contains(event.target)) {
            menuOptions.style.display = 'none';
            menuButton.setAttribute('aria-expanded', 'false');
          }
          if (!menuButtonmob.contains(event.target) && !menuOptionsmob.contains(event.target)) {
            menuOptionsmob.style.display = 'none';
            menuButtonmob.setAttribute('aria-expanded', 'false');
          }
        });
        
    </script>

    
    
</body>

